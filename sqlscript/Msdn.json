{
	"name": "Msdn",
	"properties": {
		"content": {
			"query": "\n-- https://csvstoragedemo001.blob.core.windows.net/peoples/peoples.csv\n-- https://csvstoragedemo001.blob.core.windows.net/peoples\n\n-- How do you drop the master key\nIF EXISTS (SELECT * FROM SYS.KEY_ENCRYPTIONS ke WHERE ke.crypt_type = 'ESKM' )\nBEGIN\n    PRINT 'yes there is a master key'\n    -- USE MASTER\n    -- DROP MASTER KEY\n    --  Changed database context to 'master'. Cannot drop master key because certificate '##MS_InstanceCertificate##' is encrypted by it.\n\nEND\nELSE\nBEGIN\n    PRINT 'No master key found'\nEND\n\nIF NOT EXISTS (SELECT * FROM SYS.KEY_ENCRYPTIONS ke WHERE ke.crypt_type = 'ESKM' )\nBEGIN\n    PRINT 'No master key found'\nEND\n\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'Pass@word123'\n\n\n--did not work, you got to hard code\n-- DECLARE @sas AS NVARCHAR(200)\n-- SET @sas='sp=r&st=2022-06-13T21:07:28Z&se=2023-06-14T05:07:28Z&spr=https&sv=2021-06-08&sr=c&sig=8bf3McO3OMTPrFxBColIntUwuFp6UU6W1763FNkaBTU%3D'\n-- PRINT @sas\n\n-- 'sp=r&st=2022-04-26T21:31:27Z&se=2022-06-02T05:31:27Z&spr=https&sv=2020-08-04&sr=c&sig=nR9eVI0N5%2BZL5rL3NJGdreRKTpGrW3DN784zmJYKCz4%3D'\nIF EXISTS (SELECT * FROM SYS.DATABASE_SCOPED_CREDENTIALS WHERE [name] = 'PEOPLESCREDENTIAL') DROP DATABASE SCOPED CREDENTIAL PEOPLESCREDENTIAL\nCREATE DATABASE SCOPED CREDENTIAL PEOPLESCREDENTIAL\nWITH \n    IDENTITY = 'SHARED ACCESS SIGNATURE', \n    SECRET = 'sp=r&st=2022-06-13T21:07:28Z&se=2023-06-14T05:07:28Z&spr=https&sv=2021-06-08&sr=c&sig=8bf3McO3OMTPrFxBColIntUwuFp6UU6W1763FNkaBTU%3D'\n    \n    -- sp=r&st=2022-04-26T21:31:27Z&se=2022-06-02T05:31:27Z&spr=https&sv=2020-08-04&sr=c&sig=nR9eVI0N5%2BZL5rL3NJGdreRKTpGrW3DN784zmJYKCz4%3D\n\n\nIF EXISTS (SELECT * FROM sys.external_data_sources WHERE [name]='peoplesdemo')\nBEGIN\n    print 'Dropping data source peoplesdemo'\n    DROP EXTERNAL DATA SOURCE peoplesdemo\nEND\n\ncreate external data source peoplesdemo\nwith ( \n    -- location = 'https://csvstoragedemo001.blob.core.windows.net/' ,  --did not work\n    location = 'https://csvstoragedemo001.blob.core.windows.net/junk' ,\n    CREDENTIAL = PEOPLESCREDENTIAL \n    --TYPE = BLOB_STORAGE\n    );\n\n--\n\nselect *\nfrom openrowset(\n        bulk '/peoples.csv',\n        data_source = 'peoplesdemo',\n        format = 'csv',\n        parser_version ='2.0'\n    ) as rows\n\n\nIF EXISTS (SELECT * FROM SYS.OBJECTS WHERE [name]='Peoples' AND [TYPE]='U')\nBEGIN\n    DROP EXTERNAL TABLE Peoples\n    PRINT 'Table peoples was dropped'\nEND\nGO\nIF EXISTS (SELECT * FROM sys.external_file_formats WHERE [name]='CSVFORMAT') \nBEGIN\n    DROP EXTERNAL FILE FORMAT CSVFORMAT\n    PRINT 'external file format CSVFORMAT was dropped'\nEND\nGO\nCREATE EXTERNAL FILE FORMAT CSVFORMAT WITH \n    (  \n        FORMAT_TYPE = DELIMITEDTEXT,\n        FORMAT_OPTIONS \n            (\n                FIRST_ROW=2,\n                FIELD_TERMINATOR=',',\n                STRING_DELIMITER='\"'                \n            )\n    )\nPRINT 'external file format CSVFORMAT was created'\nGO\nIF EXISTS (SELECT * FROM SYS.OBJECTS WHERE [name]='Peoples' AND [TYPE]='U')\nBEGIN\n    DROP EXTERNAL TABLE Peoples\n    PRINT 'Table peoples was dropped'\nEND\nGO\nCREATE EXTERNAL TABLE Peoples (\n     --int,\n     id nvarchar(20),\n     firstname nvarchar(50),\n     lastname nvarchar(50),\n) WITH (\n         LOCATION = '/peoples.csv',\n         DATA_SOURCE = peoplesdemo,\n         --FORMAT='csv'\n         FILE_FORMAT = CSVFORMAT\n);\nPRINT 'Table peoples was created'\nGO\nSELECT * FROM Peoples\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "myserverlessdb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}