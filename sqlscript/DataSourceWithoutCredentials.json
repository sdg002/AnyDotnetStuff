{
	"name": "DataSourceWithoutCredentials",
	"properties": {
		"description": "trying data source with no explicit credentials",
		"content": {
			"query": "\n--SELECT * FROM SYS.DATABASES\n\nIF EXISTS (SELECT * FROM sys.external_data_sources WHERE [name]='peoplesdemo')\nBEGIN\n    print 'Dropping data source peoplesdemo'\n    DROP EXTERNAL DATA SOURCE peoplesdemo\nEND\n\n/*\ndid not work using \nhttps://docs.microsoft.com/en-us/azure/synapse-analytics/sql/develop-storage-files-storage-access-control?tabs=managed-identity\n\nCREATE CREDENTIAL [https://csvstoragedemo001.dfs.core.windows.net/junk]\nWITH IDENTITY='Managed Identity'\n*/\n\n/*\ndid nto work\nCREATE CREDENTIAL [https://csvstoragedemo001.blob.core.windows.net/junk]\nWITH IDENTITY='Managed Identity'\n*/\n\nIF EXISTS (SELECT * FROM SYS.DATABASE_SCOPED_CREDENTIALS WHERE [name] = 'PEOPLESCREDENTIAL') \nBEGIN\n    DROP DATABASE SCOPED CREDENTIAL PEOPLESCREDENTIAL\n    PRINT 'DROPPED THE CREDENTIAL'\nEND\nGO\nCREATE DATABASE SCOPED CREDENTIAL PEOPLESCREDENTIAL\nWITH IDENTITY = 'Managed Identity';\nPRINT 'Created managed identity'\n GO\n-- CREATE EXTERNAL DATA SOURCE mysample\n-- WITH (    LOCATION   = 'https://<storage_account>.dfs.core.windows.net/<container>/<path>',\n--           CREDENTIAL = SynapseIdentity\n--)\n\n\ncreate external data source peoplesdemo\nwith ( \n    location = 'https://csvstoragedemo001.blob.core.windows.net/junk', \n    CREDENTIAL = PEOPLESCREDENTIAL \n    )\n\n-- create external data source peoplesdemo\n-- with ( \n--     -- location = 'https://csvstoragedemo001.blob.core.windows.net/' ,  --did not work\n--     location = 'https://csvstoragedemo001.blob.core.windows.net/junk' ,\n--     CREDENTIAL = PEOPLESCREDENTIAL \n--     --TYPE = BLOB_STORAGE\n--     );\n\n--trying the following\n\nPRINT 'Created external data source'\n\n\n\nselect *\nfrom openrowset(\n        bulk '/peoples.csv',\n        data_source = 'peoplesdemo',\n        format = 'csv',\n        parser_version ='2.0'\n    ) as rows\n\n\n/*\nTrying to create datasource without credentials\nThis does not work!\nFile 'peoples.csv' cannot be opened because it does not exist or it is used by another process.\n\n*/\n-- \n\nselect *\nfrom openrowset(\n        bulk '/peoples.csv',\n        data_source = 'peoplesdemo',\n        format = 'csv',\n        parser_version ='2.0'\n    ) as rows\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "myserverlessdb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}